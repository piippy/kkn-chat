<?php
require_once "conversation.php";

$init = array(
  array(
    'text' => ":) р╕кр╕зр╕▒р╕кр╕Фр╕╡р╕Др╕гр╕▒р╕Ъ р╣Бр╕Бр╣Ир╕Щр╕Вр╕Щр╕╕р╕Щ р╕вр╕┤р╕Щр╕Фр╕╡р╣Гр╕лр╣Йр╕Ър╕гр╕┤р╕Бр╕▓р╕гр╕Др╕гр╕▒р╕Ъ\r\nЁЯТм р╕лр╕▓р╕Бр╕Чр╣Ир╕▓р╕Щр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╣Ир╕н р╕Ир╕Щр╕Ч р╕гр╕Ър╕Бр╕зр╕Щр╕Юр╕┤р╕бр╕Юр╣Мр╕зр╣Ир╕▓ \"р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╣Ир╕н\" р╕Чр╕┤р╣Йр╕Зр╣Др╕зр╣Йр╕Щр╕░р╕Др╕гр╕▒р╕Ъ",
    "quick_replies" => array(
      array("content_type" => "text", "title" => "р╕кр╕нр╕Ър╕Цр╕▓р╕бр╕Кр╕╕р╕Фр╕Шр╕╕р╕Фр╕Зр╕Др╣М", "payload" => "TD"),
      array("content_type" => "text", "title" => "р╕кр╕нр╕Ър╕Цр╕▓р╕бр╕Кр╕╕р╕Фр╕бр╕╡р╕кр╕╕р╕В", "payload" => "MS")
    )
  )
);
$Meesuk = array(
  array(
    'text' => ":) р╕гр╕нр╕Зр╣Ар╕Чр╣Йр╕▓р╣Бр╕Хр╕░р╕Кр╕╕р╕Фр╕бр╕╡р╕кр╕╕р╕Вр╕бр╕╡ 3 р╣Бр╕Ър╕Ър╕Хр╕▓р╕бр╕ар╕▓р╕Юр╕Др╕гр╕▒р╕Ъ\r\nЁЯСЮ р╕гр╕▓р╕Др╕▓р╕Др╕╣р╣Ир╕ер╕░ 220р╕Ър╕▓р╕Ч\r\nЁЯСЮ р╕бр╕╡р╣Др╕Лр╕кр╣М 39-44р╕Др╕гр╕▒р╕Ъ",
    "attachment" => array(
      "type" => "image",
      "payload" => array(
        "url" => "https://kkn-chat.herokuapp.com/img/ms.mix.png",
        "is_reusable" => true
      )
    ),
    "quick_replies" => array(
      array("content_type" => "text", "title" => "р╕кр╕▒р╣Ир╕Зр╕гр╕нр╕Зр╣Ар╕Чр╣Йр╕▓", 'payload' => 'dumb'),
      array("content_type" => "text", "title" => "р╕кр╕нр╕Ър╕Цр╕▓р╕бр╕Др╣Ир╕▓р╕Ър╕гр╕┤р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕кр╣Ир╕З", 'payload' => 'dumb'),
      array("content_type" => "text", "title" => "р╕Хр╕┤р╕Фр╕Хр╣Ир╕нр╣Ар╕Ир╣Йр╕▓р╕лр╕Щр╣Йр╕▓р╕Чр╕╡р╣И", 'payload' => 'dumb')
    )
  )
);
$shipping = array(
  array(
    'text' => ":) р╕Др╣Ир╕▓р╕Ър╕гр╕┤р╕Бр╕▓р╕гр╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕кр╣Ир╕З р╕кр╕▒р╣Ир╕Зр╕Бр╕╡р╣Ир╕Др╕╣р╣Ир╕гр╕▓р╕Др╕▓р╕кр╣Ир╕Зр╕Бр╣Зр╣Ар╕Чр╣Ир╕▓р╕Бр╕▒р╕Щр╕Др╕гр╕▒р╕Ъ\r\n\r\nЁЯУж р╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╕Фр╣Йр╕зр╕в Kerry р╣Бр╕Ър╕Ър╣Ар╕Бр╣Зр╕Ър╣Ар╕Зр╕┤р╕Щр╕Ыр╕ер╕▓р╕вр╕Чр╕▓р╕З: 100р╕Ър╕▓р╕Ч\r\nЁЯУж р╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╕Фр╣Йр╕зр╕в р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣М р╣Бр╕Ър╕ЪEMS(р╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ): 60р╕Ър╕▓р╕Ч\r\nЁЯУж р╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╕Фр╣Йр╕зр╕в Kerry(р╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ): 80р╕Ър╕▓р╕Ч\r\nЁЯУж р╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╕Фр╣Йр╕зр╕в р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣М р╣Бр╕Ър╕Ър╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╕Шр╕гр╕гр╕бр╕Фр╕▓: 20р╕Ър╕▓р╕Ч\r\n\r\n:) р╕Др╣Ир╕▓р╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╕Хр╕▓р╕бр╕Щр╕╡р╣Йр╕Др╕гр╕▒р╕Ър╕Ьр╕б",
    "quick_replies" => array(
      array("content_type" => "text", "title" => "р╕кр╕▒р╣Ир╕Зр╕гр╕нр╕Зр╣Ар╕Чр╣Йр╕▓", 'payload' => 'dumb'),
      array("content_type" => "text", "title" => "р╕Хр╕┤р╕Фр╕Хр╣Ир╕нр╣Ар╕Ир╣Йр╕▓р╕лр╕Щр╣Йр╕▓р╕Чр╕╡р╣И", 'payload' => 'dumb')
    )
  )
);
$resp = array(
  'TD' => array(
    array('text' => ":) р╕гр╕нр╕Зр╣Ар╕Чр╣Йр╕▓р╣Бр╕Хр╕░р╕Кр╕╕р╕Фр╕Шр╕╕р╕Фр╕Зр╕Др╣Мр╕бр╕╡ 4 р╣Бр╕Ър╕Ър╕Хр╕▓р╕бр╕ар╕▓р╕Юр╕Др╕гр╕▒р╕Ъ\r\nЁЯСЮ р╕гр╕▓р╕Др╕▓р╕Др╕╣р╣Ир╕ер╕░ 540р╕Ър╕▓р╕Ч\r\nЁЯСЮ р╕бр╕╡р╣Др╕Лр╕кр╣М 40-45р╕Др╕гр╕▒р╕Ъ"),
    array("attachment" => array(
      "type" => "image",
      "payload" => array(
        "url" => "https://kkn-chat.herokuapp.com/img/td.mix.png",
        "is_reusable" => true
      )
    )),
    array(
      "text" => ":) р╕кр╕Щр╣Гр╕Ир╣Бр╕Ър╕Ър╣Др╕лр╕Щр╕нр╕вр╕╣р╣Ир╕Др╕гр╕▒р╕Ъ",
      "quick_replies" => array(
        array("content_type" => "text", "title" => "1.р╕лр╕Щр╕╡р╕Ър╕Хр╕▓р╕е", "payload" => "TD205"),
        array("content_type" => "text", "title" => "2.р╕лр╕Щр╕╡р╕Ър╣Бр╕Чр╕Щ", "payload" => "TD206"),
        array("content_type" => "text", "title" => "3.р╕кр╕зр╕б3р╕Кр╕▒р╣Йр╕Щр╕Хр╕▓р╕е", "payload" => "TD207"),
        array("content_type" => "text", "title" => "4.р╕кр╕зр╕б2р╕Кр╕▒р╣Йр╕Щр╕Хр╕▓р╕е", "payload" => "TD208")
      )
    )
  ),
  'MS' => array(
    array('text' => ":) р╕гр╕нр╕Зр╣Ар╕Чр╣Йр╕▓р╣Бр╕Хр╕░р╕Кр╕╕р╕Фр╕бр╕╡р╕кр╕╕р╕Вр╕бр╕╡ 3 р╣Бр╕Ър╕Ър╕Хр╕▓р╕бр╕ар╕▓р╕Юр╕Др╕гр╕▒р╕Ъ\r\nЁЯСЮ р╕гр╕▓р╕Др╕▓р╕Др╕╣р╣Ир╕ер╕░ 220р╕Ър╕▓р╕Ч\r\nЁЯСЮ р╕бр╕╡р╣Др╕Лр╕кр╣М 39-44р╕Др╕гр╕▒р╕Ъ"),
    array("attachment" => array(
      "type" => "image",
      "payload" => array(
        "url" => "https://kkn-chat.herokuapp.com/img/ms.mix.png",
        "is_reusable" => true
      )
    )),
    array(
      "text" => ":) р╕кр╕Щр╣Гр╕Ир╣Бр╕Ър╕Ър╣Др╕лр╕Щр╕нр╕вр╕╣р╣Ир╕Др╕гр╕▒р╕Ъ",
      "quick_replies" => array(
        array("content_type" => "text", "title" => "1.р╕лр╕Щр╕╡р╕Ър╣Ар╕гр╕╡р╕вр╕Ъ", "payload" => "MS105"),
        array("content_type" => "text", "title" => "2.р╕лр╕Щр╕╡р╕Ър╕ер╕▓р╕в", "payload" => "MS106"),
        array("content_type" => "text", "title" => "3.р╕кр╕зр╕б", "payload" => "MS107")
      )
    )
  ),
  'TDSize' => array(
    array(
      'text' => ":) р╣Ар╕ер╕╖р╕нр╕Бр╕Вр╕Щр╕▓р╕Фр╕гр╕нр╕Зр╣Ар╕Чр╣Йр╕▓р╣Др╕Фр╣Йр╣Ар╕ер╕вр╕Др╕гр╕▒р╕Ъ",
      "quick_replies" => array(
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М40", "payload" => "#40"),
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М41", "payload" => "#41"),
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М42", "payload" => "#42"),
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М43", "payload" => "#43"),
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М44", "payload" => "#44"),
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М45", "payload" => "#45")
      )
    )
  ),
  'MSSize' => array(
    array(
      'text' => ":) р╣Ар╕ер╕╖р╕нр╕Бр╕Вр╕Щр╕▓р╕Фр╕гр╕нр╕Зр╣Ар╕Чр╣Йр╕▓р╣Др╕Фр╣Йр╣Ар╕ер╕вр╕Др╕гр╕▒р╕Ъ",
      "quick_replies" => array(
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М39", "payload" => "#39"),
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М40", "payload" => "#40"),
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М41", "payload" => "#41"),
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М42", "payload" => "#42"),
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М43", "payload" => "#43"),
        array("content_type" => "text", "title" => "р╣Ар╕Ър╕нр╕гр╣М44", "payload" => "#44")
      )
    )
  ),
  'ship' => array(
    array(
      'text' => ":) р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╣Др╕Фр╣Йр╣Ар╕ер╕вр╕Др╕гр╕▒р╕Ъ",
      "quick_replies" => array(
        array("content_type" => "text", "title" => "Kerry р╣Ар╕Бр╣Зр╕Ър╕Ыр╕ер╕▓р╕вр╕Чр╕▓р╕З", "payload" => "$1"),
        array("content_type" => "text", "title" => "р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣М EMS", "payload" => "$2"),
        array("content_type" => "text", "title" => "Kerry р╕Шр╕гр╕гр╕бр╕Фр╕▓", "payload" => "$3"),
        array("content_type" => "text", "title" => "р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╕Шр╕гр╕гр╕бр╕Фр╕▓", "payload" => "$4")
      )
    )
  )
);
$term = array(
  'TD205' => 'р╕лр╕Щр╕╡р╕Ър╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕ер╣Ар╕Вр╣Йр╕б',
  'TD206' => 'р╕лр╕Щр╕╡р╕Ър╕кр╕╡р╕Щр╣Йр╕│р╣Бр╕Чр╕Щ',
  'TD207' => 'р╕кр╕зр╕б3р╕Кр╕▒р╣Йр╕Щр╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕ер╣Ар╕Вр╣Йр╕б',
  'TD208' => 'р╕кр╕зр╕б2р╕Кр╕▒р╣Йр╕Щр╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕ер╣Ар╕Вр╣Йр╕б',
  'MS105' => 'р╕лр╕Щр╕╡р╕Ър╣Ар╕гр╕╡р╕вр╕Ъ',
  'MS106' => 'р╕лр╕Щр╕╡р╕Ър╕ер╕▓р╕в',
  'MS107' => 'р╕кр╕зр╕б',
  'TDPrice' => '540',
  'MSPrice' => '220',
  'ship1' => 'Kerry р╣Бр╕Ър╕Ър╣Ар╕Бр╣Зр╕Ър╣Ар╕Зр╕┤р╕Щр╕Ыр╕ер╕▓р╕вр╕Чр╕▓р╕З 100р╕Ър╕▓р╕Ч',
  'ship2' => 'р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣М р╣Бр╕Ър╕ЪEMS 60р╕Ър╕▓р╕Ч',
  'ship3' => 'Kerry р╣Бр╕Ър╕Ър╕Шр╕гр╕гр╕бр╕Фр╕▓ 80р╕Ър╕▓р╕Ч',
  'ship4' => 'р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣М р╣Бр╕Ър╕Ър╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╕Шр╕гр╕гр╕бр╕Фр╕▓ 20р╕Ър╕▓р╕Ч',
  'pro' => "ЁЯФе р╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕кр╣Ир╕зр╕Щр╕ер╕Фр╕Юр╕┤р╣Ар╕ир╕й 41р╕Ър╕▓р╕Ч\r\n"
);

function concat_payloadToResp($payload, $responses) {
  foreach ($responses as &$response)
    if (isset($response['quick_replies']))
      foreach ($response['quick_replies'] as &$reply)
        $reply['payload'] = $payload . $reply['payload'];
  return $responses;
}

function get_responses($payload) {
  global $init;
  global $Meesuk;
  global $shipping;
  global $resp;
  global $term;

  if ($payload == 'init')
    return $init;

  if ($payload == 'Meesuk')
    return $Meesuk;

  if ($payload == 'shipping')
    return $shipping;

  if (strlen($payload) == 2)
    return $resp[$payload];

  if (strlen($payload) == 5)
    return concat_payloadToResp($payload, $resp[substr($payload, 0, 2) . 'Size']);

  if (strlen($payload) == 8)
    return concat_payloadToResp($payload, $resp['ship']);

  if (strlen($payload) == 10) {
    $model = $term[substr($payload, 0, 5)];
    $size = substr($payload, 6, 2);
    $price = $term[substr($payload, 0, 2) . 'Price'];
    $ship = $term['ship' . substr($payload, 9, 1)];
    $pro = substr($payload, 0, 2) == 'TD' ? $term['pro'] : '';
    $total = 0;
    if (substr($payload, 0, 2) == 'TD')
      $total += 499;
    if (substr($payload, 0, 2) == 'MS')
      $total += 220;
    if (substr($payload, 9, 1) == '1')
      $total += 100;
    if (substr($payload, 9, 1) == '2')
      $total += 60;
    if (substr($payload, 9, 1) == '3')
      $total += 80;
    if (substr($payload, 9, 1) == '4')
      $total += 20;
    $bill = substr($payload, 9, 1) == '1' ? '' : "р╕Юр╕гр╣Йр╕нр╕бр╣Бр╕кр╕Фр╕Зр╕лр╕ер╕▒р╕Бр╕Рр╕▓р╕Щр╕Бр╕▓р╕гр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ";
    $finalResp = array();
    if (substr($payload, 0, 2) == 'TD')
      $finalResp[] = array('text' => "ЁЯФе р╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╕бр╕╡р╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕Юр╕┤р╣Ар╕ир╕йр╣Ар╕Йр╕Юр╕▓р╕░р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╣Гр╕лр╕бр╣Ир╕Чр╕▓р╕Зр╣Ар╕Яр╕кр╕Ър╕╕р╣Кр╕Др╕Щр╕░р╕Др╕гр╕▒р╕Ъ\r\nЁЯСН р╣Ар╕Юр╕╡р╕вр╕Зр╕Бр╕Фр╣Др╕ер╕Др╣Мр╣Бр╕ер╕░р╕Бр╕Фр╣Бр╕Кр╕гр╣Мр╣Ар╕Юр╕Ир╣Бр╕Бр╣Ир╕Щр╕Вр╕Щр╕╕р╕Щр╣Др╕Ыр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓р╕зр╕нр╕ер╕Вр╕нр╕Зр╕Хр╕▒р╕зр╣Ар╕нр╕З\r\nтЬи р╕гр╕▒р╕Ър╕кр╣Ир╕зр╕Щр╕ер╕Фр╕гр╕▓р╕Др╕▓р╕гр╕нр╕Зр╣Ар╕Чр╣Йр╕▓р╕Юр╕┤р╣Ар╕ир╕й 7.5% р╕Ир╕▓р╕Б540р╕Ър╕▓р╕Ч р╣Ар╕лр╕ер╕╖р╕н499р╕Ър╕▓р╕Чр╣Др╕Фр╣Йр╣Ар╕ер╕вр╕Др╕гр╕▒р╕Ъ");
    $finalResp[] = array('text' => "ЁЯСЮ р╕гр╕нр╕Зр╣Ар╕Чр╣Йр╕▓р╣Бр╕Хр╕░р╣Бр╕Ър╕Ъ$model р╣Ар╕Ър╕нр╕гр╣М$size р╕Ир╕│р╕Щр╕зр╕Щ 1р╕Др╕╣р╣И р╕гр╕▓р╕Др╕▓{$price}р╕Ър╕▓р╕Ч\r\nЁЯУж р╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╕Фр╣Йр╕зр╕в $ship\r\n{$pro}ЁЯТ░ р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф {$total}р╕Ър╕▓р╕Ч\r\n\r\n:) р╕гр╕Ър╕Бр╕зр╕Щр╣Бр╕Ир╣Йр╕З р╕Кр╕╖р╣Ир╕н р╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣И р╣Бр╕ер╕░р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕гр╕Хр╕┤р╕Фр╕Хр╣Ир╕н р╕Вр╕нр╕Зр╕Ьр╕╣р╣Йр╕гр╕▒р╕Ъ{$bill}р╕Фр╣Йр╕зр╕вр╕Др╕гр╕▒р╕Ър╕Ьр╕б");
    if (substr($payload, 9, 1) != '1')
      $finalResp[] = array('text' => "ЁЯПж р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Ър╕▒р╕Нр╕Кр╕╡\r\nр╕Шр╕Щр╕▓р╕Др╕▓р╕г: р╕Бр╕кр╕┤р╕Бр╕гр╣Др╕Чр╕в\r\nр╕Кр╕╖р╣Ир╕нр╕Ър╕▒р╕Нр╕Кр╕╡: р╕Щр╕▓р╕вр╕ар╕▒р╕Чр╕Бр╕г р╕Др╕╣р╕Ур╕▓р╕Щр╕╕р╕ар╕▓р╕Юр╕Бр╕╕р╕е\r\nр╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╕Ър╕▒р╕Нр╕Кр╕╡: 037-8-35766-7");
    return $finalResp;
  }
}
